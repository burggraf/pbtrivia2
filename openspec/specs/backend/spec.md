# backend Specification

## Purpose
TBD - created by archiving change setup-pocketbase-backend. Update Purpose after archive.
## Requirements
### Requirement: PocketBase Initialization
The system SHALL initialize PocketBase with a proper directory structure and configuration.

#### Scenario: First-time initialization
- **WHEN** PocketBase is run for the first time
- **THEN** it creates the pb_data directory with SQLite database
- **AND** the admin dashboard is accessible at http://127.0.0.1:8090/_/

#### Scenario: Data persistence
- **WHEN** PocketBase is restarted
- **THEN** all collections and data persist from the previous session

### Requirement: Questions Collection Schema
The system SHALL create a `questions` collection with fields matching the trivia database requirements.

#### Scenario: Collection exists with required fields
- **WHEN** the questions collection is created
- **THEN** it includes the following fields:
  - `id` (text, 15-char autogenerated, primary key)
  - `category` (text, indexed for fast filtering)
  - `subcategory` (text)
  - `difficulty` (text, values: "easy", "medium", "hard")
  - `question` (text)
  - `a` (text, always the correct answer)
  - `b` (text, incorrect answer)
  - `c` (text, incorrect answer)
  - `d` (text, incorrect answer)
  - `metadata` (json, optional)
  - `created` (datetime, auto-generated)
  - `updated` (datetime, auto-updated)

#### Scenario: Category index performance
- **WHEN** filtering questions by category
- **THEN** queries complete in under 100ms for any category

### Requirement: Questions Data Migration
The system SHALL import all questions from questions.tsv into the PocketBase questions collection.

#### Scenario: Successful data import
- **WHEN** the migration script runs against questions.tsv
- **THEN** all 61,257 questions (61,258 lines minus header) are imported
- **AND** each question's fields map correctly from TSV columns to collection fields
- **AND** the correct answer is always stored in column "a"

#### Scenario: Data validation during import
- **WHEN** importing questions
- **THEN** the script validates that each row has all required fields
- **AND** skips any malformed rows with a warning message
- **AND** reports the total count of imported vs. skipped records

#### Scenario: Idempotent import
- **WHEN** the migration script runs multiple times
- **THEN** it does not create duplicate questions
- **AND** existing questions with matching IDs are updated, not duplicated

### Requirement: Collection Access Control
The system SHALL configure API rules for the questions collection to enable read access and prevent unauthorized modifications.

#### Scenario: Public read access
- **WHEN** any authenticated user requests questions
- **THEN** they can read all question records via the REST API

#### Scenario: Admin-only write access
- **WHEN** a non-admin user attempts to create, update, or delete questions
- **THEN** the request is denied with a 403 Forbidden error

#### Scenario: Unauthenticated access denied
- **WHEN** an unauthenticated request is made to the questions collection
- **THEN** the request is denied with a 401 Unauthorized error

### Requirement: Admin Superuser
The system SHALL provide a way to create an admin superuser for managing PocketBase collections and settings.

#### Scenario: Admin creation
- **WHEN** the admin superuser is created
- **THEN** the admin can access the PocketBase admin dashboard
- **AND** the admin can manage all collections, users, and settings

#### Scenario: Secure admin credentials
- **WHEN** creating the admin superuser
- **THEN** a strong password is required (minimum 10 characters)

